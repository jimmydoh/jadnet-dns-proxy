services:
  jadnet-dns-proxy:
    build: .
    restart: unless-stopped
    ports:
      - "5054:5053/udp"
    environment:
      - LISTEN_PORT=5053
      # Multiple upstream DoH servers (comma-separated)
      - DOH_UPSTREAM=https://1.1.1.1/dns-query,https://1.0.0.1/dns-query
      # - DOH_UPSTREAM=https://dns.google/dns-query,https://cloudflare-dns.com/dns-query # Alternate
      - WORKER_COUNT=20       # Scale up for high volume
      - QUEUE_SIZE=2000       # Buffer size for spikes
      - CACHE_ENABLED=true
      - LOG_LEVEL=INFO
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
        
